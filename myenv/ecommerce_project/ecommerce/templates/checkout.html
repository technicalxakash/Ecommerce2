<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout - Simple E-Commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5 text-center">
  <h2 class="mb-4">ðŸ’° Checkout Summary</h2>

  {% if cart %}
  <ul class="list-group mb-4">
    {% for key, item in cart.items %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      {{ item.name }} (x{{ item.quantity }})
      <span>â‚¹{{ item.price|floatformat:2 }}</span>
    </li>
    {% endfor %}
  </ul>

  <h4>Total: â‚¹{{ total }}</h4>
  <button id="rzp-button1" class="btn btn-success btn-lg mt-3">Proceed to Pay</button>

  {% else %}
  <p>Your cart is empty.</p>
  {% endif %}
</div>

<!-- Razorpay Script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  var options = {
      "key": "{{ razorpay_key_id }}",
      "amount": "{{ razorpay_amount }}",
      "currency": "INR",
      "name": "Simple E-Commerce",
      "description": "E-Commerce Payment",
      "order_id": "{{ razorpay_order_id }}",
      "handler": function (response) {
          // Send payment success details to Django backend via POST
          var form = document.createElement('form');
          form.method = 'POST';
          form.action = "/payment-success/";

          var csrftoken = '{{ csrf_token }}';
          var csrfInput = document.createElement('input');
          csrfInput.type = 'hidden';
          csrfInput.name = 'csrfmiddlewaretoken';
          csrfInput.value = csrftoken;
          form.appendChild(csrfInput);

          var input1 = document.createElement('input');
          input1.type = 'hidden';
          input1.name = 'razorpay_payment_id';
          input1.value = response.razorpay_payment_id;
          form.appendChild(input1);

          document.body.appendChild(form);
          form.submit();
      },
      "prefill": {
          "name": "{{ request.user.username }}",
          "email": "test@example.com",
          "contact": "9999999999"
      },
      "theme": {
          "color": "#528FF0"
      }
  };
  var rzp1 = new Razorpay(options);
  document.getElementById('rzp-button1').onclick = function(e){
      rzp1.open();
      e.preventDefault();
  }
</script>
</body>
</html>
